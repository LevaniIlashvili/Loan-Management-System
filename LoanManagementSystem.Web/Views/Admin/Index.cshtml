@model List<LoanApplicationViewModel>

@{
    var errorMessage = TempData["ErrorMessage"] ?? ViewBag.ErrorMessage;
    var successMessage = TempData["SuccessMessage"];
}

@if (successMessage != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @successMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (errorMessage != null)  
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @errorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="bi bi-list-ul"></i> Loan Applications Management</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Client Name</th>
                    <th>Personal Number</th>
                    <th>Monthly Income</th>
                    <th>Loan Amount</th>
                    <th>Term</th>
                    <th>Applied Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var loan in Model)
                {
                    <tr style="position: relative; cursor: pointer;">
                        <td class="fw-bold">
                            <a asp-action="Details" asp-route-id="@loan.Id" class="stretched-link text-decoration-none text-dark">
                                @loan.ClientFirstName @loan.ClientLastName
                            </a>
                        </td>
                        <td>@loan.ClientPersonalNumber</td>
                        <td>@loan.ClientMonthlyIncome.ToString("N2") ₾</td>
                        <td class="text-primary fw-bold">@loan.Amount.ToString("N2") ₾</td>
                        <td>@loan.TermInMonths Months</td>
                        <td>@loan.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            @{
                                string badgeClass = loan.LoanStatus.ToString() switch
                                {
                                                "Approved" => "bg-success",
                                                "Rejected" => "bg-danger",
                                                "Pending" => "bg-warning text-dark",
                                    _ => "bg-secondary"
                                };
                            }
                            <span class="badge @badgeClass">@loan.LoanStatus</span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>